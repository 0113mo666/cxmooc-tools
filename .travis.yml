language: node_js
sudo: required

notifications:
  email: 
    on_failure: always

dist: xenial

node_js: stable

cache:
# yarn: true
  directories:
    - node_modules

before_install:
 - export TZ='Asia/Shanghai'
 - npm install

script: 
 - npm run build
 - zip -r build/upload/cxmooc-tools.crx build/cxmooc-tools/
 - zip -r build/upload/cxmooc-tools.zip build/cxmooc-tools/
 - zip -r build/upload/cxmooc-tools.tar.gz build/cxmooc-tools/

deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: 
    - build/upload/*.crx
    - build/upload/*.zip
    - build/upload/*.tar.gz
  skip_cleanup: true
  # draft: true
  on:
    tags: true